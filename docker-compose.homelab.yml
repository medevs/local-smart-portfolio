# =============================================================================
# Docker Compose - Homelab Override (OPTIONAL)
# =============================================================================
# This file is for homelab/CI-CD deployments using GHCR images
# Regular users should use docker-compose.yml directly
# =============================================================================
# Use with: docker compose -f docker-compose.yml -f docker-compose.homelab.yml up -d
# =============================================================================

version: '3.8'

services:
  # ===========================================================================
  # Backend Service - Use GHCR Image
  # ===========================================================================
  backend:
    # Remove build section and use GHCR image instead
    image: ghcr.io/medevs/portfolio-backend:latest
    # Keep all other settings from base compose
    pull_policy: always  # Always pull latest image

  # ===========================================================================
  # Frontend Service - Use GHCR Image
  # ===========================================================================
  # NOTE: NEXT_PUBLIC_API_URL is baked into the image at build time via
  # GitHub Actions (see .github/workflows/deploy.yml). Runtime environment
  # variables for NEXT_PUBLIC_* do NOT work - they must be build args.
  # To change the API URL, update the NEXT_PUBLIC_API_URL secret in GitHub
  # or modify the default in deploy.yml, then trigger a new build.
  # ===========================================================================
  frontend:
    image: ghcr.io/medevs/portfolio-frontend:latest
    ports:
      - "3100:3000"
    environment:
      # Only non-NEXT_PUBLIC_* runtime vars work here
      - NEXT_PUBLIC_ADMIN_API_KEY=${ADMIN_API_KEY}
    pull_policy: always

