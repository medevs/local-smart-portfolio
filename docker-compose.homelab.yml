# =============================================================================
# Docker Compose - Homelab Override
# =============================================================================
# This file is for homelab/CI-CD deployments using GHCR images
# Regular users should use docker-compose.yml directly
# =============================================================================
# Use with: docker compose -f docker-compose.yml -f docker-compose.homelab.yml up -d
# =============================================================================

services:
  # ===========================================================================
  # Backend Service - Use GHCR Image
  # ===========================================================================
  backend:
    # Override build with GHCR image
    image: ghcr.io/medevs/portfolio-backend:latest
    build: !reset null
    pull_policy: always

  # ===========================================================================
  # Frontend Service - Use GHCR Image
  # ===========================================================================
  # NOTE: NEXT_PUBLIC_API_URL is baked into the image at build time via
  # GitHub Actions (see .github/workflows/deploy.yml). Runtime environment
  # variables for NEXT_PUBLIC_* do NOT work - they must be build args.
  # To change the API URL, update the NEXT_PUBLIC_API_URL secret in GitHub
  # or modify the default in deploy.yml, then trigger a new build.
  # ===========================================================================
  frontend:
    image: ghcr.io/medevs/portfolio-frontend:latest
    build: !reset null
    ports:
      - "3100:3000"
    environment:
      # Only non-NEXT_PUBLIC_* runtime vars work here
      - NEXT_PUBLIC_ADMIN_API_KEY=${ADMIN_API_KEY}
    pull_policy: always

  # ===========================================================================
  # Ollama Init - Inherits from base compose
  # ===========================================================================
  # The ollama-init service from docker-compose.yml handles model pulling.
  # No override needed - it will pull models defined in environment vars.
  # ===========================================================================
